<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Setting Up Ubuntu Server 18.04 on Virtualbox 6 - Hadi Sinaee</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property=og:title content="Setting Up Ubuntu Server 18.04 on Virtualbox 6"><meta property=og:description content="TLDR; In this post, I am going to set up a cluster of ubuntu servers using Virtualbox 6 on a Mac OS. I will assign a static IP address to each VM using netplan and change its hostname permanently. Moreover, I will set up a NAT and Host-Only networks for having internet access and ssh accessibility from the host.
 Requirements Host-Only Networks NAT Networks Change Your Host Name Create Another Node Summary  Requirements I suppose that you have installed the Virtualbox 6."><meta property=og:type content=article><meta property=og:url content=https://hadisinaee.github.io/posts/setting-up-ubuntu-server-18.04-on-virtualbox-6/><meta property=article:published_time content=2019-05-23T23:07:48&#43;04:30><meta property=article:modified_time content=2019-05-23T23:07:48&#43;04:30><meta name=twitter:card content=summary><meta name=twitter:title content="Setting Up Ubuntu Server 18.04 on Virtualbox 6"><meta name=twitter:description content="TLDR; In this post, I am going to set up a cluster of ubuntu servers using Virtualbox 6 on a Mac OS. I will assign a static IP address to each VM using netplan and change its hostname permanently. Moreover, I will set up a NAT and Host-Only networks for having internet access and ssh accessibility from the host.
 Requirements Host-Only Networks NAT Networks Change Your Host Name Create Another Node Summary  Requirements I suppose that you have installed the Virtualbox 6."><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet href=https://hadisinaee.github.io/css/custom.css><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=/js/main.js></script></head><body><div class="container wrapper post"><div class=header><h1 class=site-title>Hadi Sinaee</h1><div class=site-description><h2>Entrepreneur, In Love With Data!</h2><nav class="nav social"><ul class=flat><a href=https://github.com/hadisinaee title=Github><i data-feather=github></i></a><a href=https://twitter.com/hadisinaee title=Twitter><i data-feather=twitter></i></a><a href=/index.xml title=RSS><i data-feather=rss></i></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></nav></div><div class=post-header><h1 class=title>Setting Up Ubuntu Server 18.04 on Virtualbox 6</h1><div class=meta>Posted at &mdash; May 23, 2019</div></div><div class=markdown><p><strong>TLDR;</strong> In this post, I am going to set up a cluster of ubuntu servers using Virtualbox 6 on a Mac OS. I will assign a static IP address to each VM using <code>netplan</code> and change its hostname permanently. Moreover, I will set up a <code>NAT</code> and <code>Host-Only</code> networks for having internet access and <code>ssh</code> accessibility from the host.</p><ol><li><a href=#requirements>Requirements</a></li><li><a href=#host-only-networks>Host-Only Networks</a></li><li><a href=#nat-networks>NAT Networks</a></li><li><a href=#change-your-host-name>Change Your Host Name</a></li><li><a href=#create-another-node>Create Another Node</a></li><li><a href=#summary>Summary</a></li></ol><h2 id=requirements>Requirements</h2><p>I suppose that you have installed the Virtualbox 6.0 and installed the Ubuntu Server 18.04 on a virtual machine. You can download the latest version of Virtualbox <a href=https://www.virtualbox.org/wiki/Downloads>here</a>. Also, you can find Ubuntu Server 18.04 at <a href=https://www.ubuntu.com/download/server>here</a>.</p><p>If you want to install Virtualbox with <code>brew</code>, you can do it with:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ brew update
$ brew cask install virtualbox</code></pre></div><p>Install <code>Open SSH Server</code> in time of installing Ubuntu Server when the installer ask you for that. You should save your <code>username</code> and <code>password</code> for your ubuntu server somewhere since you need it during the rest of this post.
<img src=/images/virtualbox-setup/vms-01.png alt=vms-01></p><p><em>P.S: There is a <a href=https://www.ceos3c.com/open-source/install-ubuntu-server-18-04-lts/>tutorial</a> if you need to know how to install Ubuntu Server 18.04 on a VM in the Virtualbox. Go with this tutorial and then come back.</em></p><h2 id=host-only-networks>Host-Only Networks</h2><p>If you want to use <code>ssh</code> to connect to your VM, you can set up a <a href=https://www.virtualbox.org/manual/ch06.html#network_hostonly>Host-Only Network</a>. This type of network in Virtualbox helps you to have both VM to Host(e.g., your laptop OS) and Host to VM connections.</p><h3 id=creating-a-host-only-network>Creating A Host-Only Network</h3><p>Select your VM and then choose <code>Host Network Manager</code> from <code>File</code> menu. Create a network as you wish:
<img src=/images/virtualbox-setup/host-only-01.png alt=host-only-01></p><p>Disable <code>DHCP Server</code> since we want to assign a static private IP address to this machine.</p><h3 id=set-vboxnet0-to-your-vm>Set <code>vboxnet0</code> To Your VM</h3><p>Go to your VM settings by selecting your VM and then <code>Settings</code>. In <code>Network</code> tab set the following:</p><ul><li><code>Attached To</code> = <code>Host-only Adapter</code></li><li><code>Name</code> = <code>vboxnet0</code></li></ul><p><img src=/images/virtualbox-setup/host-only-02.png alt=host-only-02></p><h3 id=setup-your-static-ip>Setup Your Static IP</h3><p>Now we need to config the VM to have a static IP address since each time the machine boots up its IP address doesn&rsquo;t change. Also, we use this IP address later for connecting to the VM by <code>ssh</code>.</p><p>First of all, start your VM and use your <code>user</code> and <code>password</code> to login. After that, we need to assign a static IP address to this VM so that we use it as host address for our <code>ssh</code> connection. I am going to use <code>Netplan</code> for doing so. <a href=https://netplan.io/>Netplan</a> is a network configuration tool that uses an easy way to configure your networks.</p><blockquote><p>Netplan reads network configuration from /etc/netplan/*.yaml which are written by administrators, installers, cloud image instantiations, or other OS deployments. During early boot, Netplan generates backend specific configuration files in /run to hand off control of devices to a particular networking daemon.</p></blockquote><p>Go to the following path <code>/etc/netplan/</code> and create a file named <code>01-host-only.yaml</code>. You can name it anything, but for clarity, I named it in that way. Use your favorite editor and open a newly created file. Use the following configuration:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>network:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>version:<span style=color:#bbb> </span><span style=color:#40a070>2</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span>renderer:<span style=color:#bbb> </span>networkd<span style=color:#bbb>
</span><span style=color:#bbb>  </span>ethernets:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>enp0s8:<span style=color:#bbb> </span><span style=color:#60a0b0;font-style:italic># this is your interface name for your NAT network</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>dhcp4:<span style=color:#bbb> </span>no<span style=color:#bbb>
</span><span style=color:#bbb>      </span>addresses:<span style=color:#bbb> </span>[<span style=color:#40a070>192.168</span>.<span style=color:#40a070>56.100</span>/<span style=color:#40a070>24</span>]<span style=color:#bbb>
</span><span style=color:#bbb>      </span>gateway4:<span style=color:#bbb> </span><span style=color:#40a070>192.168</span>.<span style=color:#40a070>1.1</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>nameservers:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>addresses:<span style=color:#bbb> </span>[<span style=color:#40a070>192.168</span>.<span style=color:#40a070>1.1</span>,<span style=color:#bbb> </span><span style=color:#40a070>8.8</span>.<span style=color:#40a070>8.8</span>]</code></pre></div><p>Save the file and apply your changes:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo netplan generate
$ sudo netplan apply</code></pre></div><p>Now you can see your changes via <code>ip a</code>:
<img src=/images/virtualbox-setup/ip-a-01.png alt=ip-a-01></p><h3 id=ssh-into-your-vm>SSH Into Your VM</h3><p>Now you can use the <code>ssh</code> command to connect to your running VM. In your host machine(your laptop/PC), open a terminal and:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ssh ubuntu@192.168.56.100</code></pre></div><p>You should see something like this:
<img src=/images/virtualbox-setup/ssh-01.png alt=ssh-01></p><p><em>NOTE: You can see the guest(your VM) IP address in the lower right part of your console either.</em></p><p>You don&rsquo;t have any access to the internet. To have one, in the next step, we need to set up a new type of network. Since you cannot edit your networks while your machine is running, turn off your machine and go to the next step.</p><h2 id=nat-networks>NAT Networks</h2><p>Generally, we have two types of IP addresses, public and private. By private IP addresses, I mean those who are not registered, which means you do not have access to the internet network. On the other hand, Public IP addresses are registered ones, which say you can have access to the internet network.</p><p>Due to limitations of the number of public IP addresses in IPv4, engineers designed a network which can translate a bunch of private IP addresses to public ones. Network Address Translation or NAT is intended for such a purpose.</p><p>In our case, we have a group of nodes, our ubuntu server VMs, which need to have access to the internet. Therefore, we can benefit from NAT Networks feature in Virtualbox and create such a network.</p><h3 id=creating-a-nat-network>Creating A NAT Network</h3><p>Use <code>⌘ + ,</code> to open up virtual box preferences -&gt; <code>Network</code> -&gt; create a new NAT network:
<img src=/images/virtualbox-setup/nat-network-01.png alt=nat-network-01></p><p>Open your newly created <code>NatNetwork</code> and config your NAT network as you wish. You can use the following configuration if you do not know precisely what those options are:
<img src=/images/virtualbox-setup/nat-network-02.png alt=nat-network-02></p><h3 id=set-natnetwork-to-your-vm>Set <code>NatNetwork</code> To Your VM</h3><p>Now you have created your NAT network; it&rsquo;s time to enforce your VM to use this network. Go to your VM settings page by click on the VM and then select <code>Settings</code>. In the network tab, select <code>NAT Network</code> and then from the drop down select <code>NatNetwork</code>:
<img src=/images/virtualbox-setup/nat-network-03.png alt=nat-network-03></p><h3 id=set-your-static-ip>Set Your Static IP</h3><p>Like what we did for the <code>Host-Only</code> network, we need to tell the <code>netplan</code> to set up a new static IP address for our NAT network. Turn on your machine and use your <code>ssh</code> to login to your VM. Then, go to <code>/etc/netplan/</code> and create a file named <code>02-nat-networks.yaml</code> which has the following content:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>network:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>version:<span style=color:#bbb> </span><span style=color:#40a070>2</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span>renderer:<span style=color:#bbb> </span>networkd<span style=color:#bbb>
</span><span style=color:#bbb>  </span>ethernets:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>enp0s3:<span style=color:#bbb> </span><span style=color:#60a0b0;font-style:italic># this is your interface name for your NAT network</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>dhcp4:<span style=color:#bbb> </span>no<span style=color:#bbb>
</span><span style=color:#bbb>      </span>addresses:<span style=color:#bbb> </span>[<span style=color:#40a070>10.5</span>.<span style=color:#40a070>3.100</span>/<span style=color:#40a070>24</span>]<span style=color:#bbb> </span><span style=color:#60a0b0;font-style:italic># 10.5.3.100: it is your static ip address for your NAT</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>gateway4:<span style=color:#bbb> </span><span style=color:#40a070>10.5</span>.<span style=color:#40a070>3.1</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>nameservers:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>addresses:<span style=color:#bbb> </span>[<span style=color:#40a070>8.8</span>.<span style=color:#40a070>8.8</span>]</code></pre></div><p>Again, use the following commands to make your changes permanent:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo netplan generate
$ sudo netplan apply</code></pre></div><p>use <code>ip a</code> to see your changes:
<img src=/images/virtualbox-setup/ip-a-02.png alt=ip-a-02></p><p>Now you can see that your machine has access to the internet:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ping google.com</code></pre></div><h2 id=change-your-host-name>Change Your Host Name</h2><p>Since we are going to create a cluster of nodes, we need to have some meaningful names for our nodes. In order to do change the hostname permanently, we need to tell the OS that keep our changes intact after reboot. Therefore, edit the file <code>/etc/cloud/cloud.cfg</code> to have <code>preserve_hostname: true</code>.
<img src=/images/virtualbox-setup/cloud-cfg-01.png alt=cloud-cfg-01></p><p>Run <code>hostnamectl</code>, you will see something like this:
<img src=/images/virtualbox-setup/hostnamectl-01.png alt=hostnamectl-01></p><p>In this machine, the hostname is <code>node01</code> and it is correct. If you want to name it something different you can use the following command:</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo hostnamectl set-hostname your-desired-hostname</code></pre></div><p><em>NOTE: You will need this command to change your host name in the following of this post when you create another node.</em></p><h2 id=create-another-node>Create Another Node</h2><p>Trun off your machine and then select your node. Use <code>⌘ + O</code> or use right menu click to start cloning. In the <code>MAC Address Policy</code> select to renew MAC addresses.
<img src=/images/virtualbox-setup/clone-01.png alt=clone-01></p><p>Now start your machine and login using the same credentials for <code>node-01</code>. Also, you can use the same <code>ssh</code> command for <code>node-01</code> to login to <code>node-02</code> since it has the same IP address. Therefore, we are going to change the IP addresses all networks and hostname using the same method for <code>node-01</code>.</p><p><em>NOTE: if you are connected to <code>node-02</code> using <code>ssh</code>, you may disconnect from the machine as soon as you run <code>sudo netplan apply</code> since the IP address will be changed. You need to remove lines correspond to your hosts from <code>$HOME/.ssh/known_hosts</code> to be able to use <code>ssh</code> again</em></p><p>Eventually, the network configuration changes, and hosts are able to see each other:
<img src=/images/virtualbox-setup/node01-01.png alt=node01-01>
<img src=/images/virtualbox-setup/node02-01.png alt=node02-01></p><h2 id=summary>Summary</h2><p>Now you have two virtual machines which are connected to the internet and are able to see each other. You can configure each host to use each other hostnames by editing <code>/etc/hosts</code>.</p></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='blog';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class="footer wrapper"><nav class=nav><div><a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-126465782-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script>feather.replace()</script></body></html>